<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>News Playlists - Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <style>
    body {
      background: radial-gradient(circle, rgb(251, 63, 185) 0%, rgb(8, 5, 5) 100%);
    }
    h1 { color: #f6c6ce; text-shadow: black 3px 3px 1px; }
  </style>
</head>

<body class="mx-auto p-4 w-full max-w-4xl">
  <div class="flex flex-col gap-4">
    <div class="w-full flex flex-col">
      <img src="/static/genaistudio.png" alt="Genaistudio" class="max-w-sm mx-auto" />
      <h1 class="text-3xl font-bold text-center mt-8 mb-3">News Playlists</h1>
    </div>

    <!-- Navigation -->
    <div class="flex gap-2 justify-center mb-4">
      <a href="/admin" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">&larr; Back to Admin</a>
      <a href="/admin/news" class="bg-white text-gray-700 px-4 py-2 rounded hover:bg-gray-100">Dashboard</a>
      <a href="/admin/news/sources" class="bg-white text-gray-700 px-4 py-2 rounded hover:bg-gray-100">Sources</a>
      <a href="/admin/news/articles" class="bg-white text-gray-700 px-4 py-2 rounded hover:bg-gray-100">Articles</a>
      <a href="/admin/news/playlists" class="bg-pink-600 text-white px-4 py-2 rounded hover:bg-pink-700">Playlists</a>
    </div>

    <!-- Quick Actions -->
    <div class="bg-white rounded-lg p-4 shadow">
      <div class="flex gap-4 flex-wrap">
        <form action="/admin/news/playlists/generate" method="POST">
          <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
            Generate Weekly Playlist
          </button>
        </form>
      </div>
    </div>

    <!-- Create Playlist Form -->
    <div class="bg-white rounded-lg p-4 shadow" x-data="{ showForm: false }">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold">Playlists</h2>
        <button @click="showForm = !showForm" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
          + Create Playlist
        </button>
      </div>

      <form x-show="showForm" action="/admin/news/playlists/create" method="POST" class="mb-4 p-4 bg-gray-50 rounded">
        <div class="grid grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700">Name</label>
            <input type="text" name="name" required class="mt-1 block w-full rounded border-gray-300 shadow-sm p-2 border"
              placeholder="Week 4 - 2026">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Week Number</label>
            <input type="number" name="week_number" min="1" max="53" required class="mt-1 block w-full rounded border-gray-300 shadow-sm p-2 border">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Year</label>
            <input type="number" name="year" value="2026" required class="mt-1 block w-full rounded border-gray-300 shadow-sm p-2 border">
          </div>
        </div>
        <div class="mt-4">
          <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Create</button>
          <button type="button" @click="showForm = false" class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 ml-2">Cancel</button>
        </div>
      </form>

      <!-- Playlists List -->
      {% if playlists %}
      <div class="space-y-4">
        {% for playlist in playlists %}
        <div class="border rounded-lg p-4 {% if playlist.active %}border-green-500 border-2{% endif %}" x-data="{ expanded: false }">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              {% if playlist.active %}
              <span class="px-2 py-1 text-xs bg-green-500 text-white rounded">ACTIVE</span>
              {% endif %}
              <div>
                <h3 class="font-bold">{{ playlist.name }}</h3>
                <div class="text-sm text-gray-500">Week {{ playlist.week_number }}, {{ playlist.year }} &bull; {{ playlist.article_ids|length }} articles</div>
              </div>
            </div>
            <div class="flex gap-2">
              <button @click="expanded = !expanded" class="px-3 py-1 text-sm bg-gray-200 rounded hover:bg-gray-300">
                <span x-show="!expanded">Show Articles</span>
                <span x-show="expanded">Hide</span>
              </button>
              {% if not playlist.active %}
              <form action="/admin/news/playlists/{{ playlist.id }}/activate" method="POST">
                <button type="submit" class="px-3 py-1 text-sm bg-green-500 text-white rounded hover:bg-green-600">Activate</button>
              </form>
              {% endif %}
              <form action="/admin/news/playlists/{{ playlist.id }}/delete" method="POST"
                onsubmit="return confirm('Delete this playlist?')">
                <button type="submit" class="px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600">Delete</button>
              </form>
            </div>
          </div>

          <!-- Expanded content -->
          <div x-show="expanded" class="mt-4 pt-4 border-t">
            <!-- Add article to playlist -->
            <form action="/admin/news/playlists/{{ playlist.id }}/add-article" method="POST" class="mb-4 flex gap-2">
              <select name="article_id" class="flex-1 rounded border-gray-300 p-2 border">
                <option value="">-- Select article to add --</option>
                {% for article in approved_articles %}
                {% if article.id not in playlist.article_ids %}
                <option value="{{ article.id }}">{{ article.title[:60] }}...</option>
                {% endif %}
                {% endfor %}
              </select>
              <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Add</button>
            </form>

            <!-- Articles in playlist -->
            <div class="space-y-2">
              {% for article_id in playlist.article_ids %}
              {% set article = approved_articles|selectattr('id', 'equalto', article_id)|first %}
              {% if article %}
              <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                <span class="truncate flex-1">{{ article.title }}</span>
                <form action="/admin/news/playlists/{{ playlist.id }}/remove-article/{{ article.id }}" method="POST">
                  <button type="submit" class="px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600">Remove</button>
                </form>
              </div>
              {% endif %}
              {% endfor %}
              {% if not playlist.article_ids %}
              <p class="text-gray-500 text-sm">No articles in this playlist yet.</p>
              {% endif %}
            </div>

            <!-- Preview links -->
            <div class="mt-4 pt-4 border-t">
              <div class="text-sm font-medium text-gray-700 mb-2">Preview this playlist:</div>
              <div class="flex gap-2">
                <a href="/news/portrait/{{ playlist.id }}" target="_blank" class="text-blue-600 hover:underline text-sm">Portrait</a>
                <a href="/news/landscape/{{ playlist.id }}" target="_blank" class="text-blue-600 hover:underline text-sm">Landscape</a>
                <a href="/news/presentation/{{ playlist.id }}" target="_blank" class="text-blue-600 hover:underline text-sm">Presentation</a>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p class="text-gray-500 text-center py-4">No playlists yet. Create one or generate from approved articles.</p>
      {% endif %}
    </div>

  </div>
</body>
</html>
